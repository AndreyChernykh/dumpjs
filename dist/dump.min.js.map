{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","dump.min.js","../src/dump.js","../src/utils.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","dump","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"_dereq_","root","options","_dump","obj","identifier","identities","has","set","data","_isArray$getId$isPrimitiveProperty$isPrimitive$isFunction$createObjectHandler$shellowClone$keys$isObjectRef","isArray","Object","keys","reduce","destruct","result","item","index","prop","shellowClone","serializer","isFunction","undefined","isPrimitiveProperty","generateObjId","value","objId","get","getId","id","unprocessed","push","serialized","Map","key","createObjectHandler","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","_step$value","_slicedToArray","err","JSON","stringify","restore","visited","Set","deserializer","source","parse","keysList","forEach","filter","isObjectRef","createPropHandler","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","isPrimitive","isFrozen","propDescriptor","getOwnPropertyDescriptor","writable","add","arr","Array","_arr","_n","_d","_e","_s","_i","TypeError","./utils",2,"fn","slice","merge","identity","regex","test","callback","objectHandler","memo","defineProperty","assign"],"mappings":"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","file":"dump.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",null,"'use strict';\n\nimport {\n    isArray,\n    getId,\n    isPrimitiveProperty,\n    isPrimitive,\n    isFunction,\n    createObjectHandler,\n    shellowClone,\n    keys,\n    isObjectRef\n    } from './utils';\n\nfunction dump (root, options) {\n    const serialized = {};\n    const unprocessed = [];\n    const identities = new Map();\n    let id = 0;\n    const key = getId(id);\n    const serializer = createObjectHandler(options && options.serializer);\n\n    if (root == null) return;\n\n    serialized[key] = _dump(root, key);\n\n    for (let [obj, identifier] of unprocessed)\n        serialized[identifier] = _dump(obj, identifier);\n\n    return JSON.stringify(serialized);\n\n    function _dump (obj, identifier) {\n        if (!identities.has(obj)) identities.set(obj, identifier);\n\n        const data = isArray(obj) ? obj : Object.keys(obj);\n        return data.reduce(destruct(obj), isArray(obj) ? [] : {});\n    }\n\n    function destruct (obj) {\n        return function (result, item, index) {\n            const prop = isArray(result) ? index : item;\n\n            obj = shellowClone(obj);\n            obj[prop] = serializer(prop, obj[prop]);\n\n            if (isFunction(obj[prop])) return result;\n            if (obj[prop] === undefined) return result;\n\n            if (isPrimitiveProperty(obj, prop)) {\n                result[prop] = obj[prop];\n            } else {\n                result[prop] = generateObjId(obj, prop);\n            }\n\n            return result;\n        };\n    }\n\n    function generateObjId (obj, prop) {\n        const value = obj[prop];\n        let objId;\n\n        if (!identities.has(value)) {\n            objId = getId(++id);\n            identities.set(value, objId);\n            unprocessed.push([value, objId]);\n        } else {\n            objId = identities.get(value);\n        }\n\n        return objId;\n    }\n}\n\nfunction restore (data, options) {\n    const visited = new Set();\n    const deserializer = createObjectHandler(options && options.deserializer);\n    const source = JSON.parse(data);\n    const keysList = keys(source);\n\n    if (keysList.length === 0) return source;\n\n    keysList.forEach(function (key) {\n        const obj = source[key];\n        keys(obj)\n            .filter(function (key) {\n                return isObjectRef(obj[key]);\n            })\n            .forEach(function iter (key) {\n                obj[key] = source[obj[key]];//deserializer(key, source[obj[key]]);\n            })\n        ;\n    });\n\n    keys(source['@0']).forEach(createPropHandler(source['@0'], visited, deserializer));\n\n    for (let item of visited) {\n        if (item == null || isPrimitive(item) || Object.isFrozen(item))\n            continue;\n\n        keys(item).forEach(createPropHandler(item, visited, deserializer));\n    }\n\n    return source['@0'];\n}\n\nfunction createPropHandler (item, visited, deserializer) {\n    return function propertyHandler (prop) {\n        const propDescriptor = Object.getOwnPropertyDescriptor(item, prop);\n\n        if ('set' in propDescriptor && propDescriptor.set == null) return;\n        if (propDescriptor.writable === false) return;\n\n        // TODO if returned value didn't changed, don't assign it\n        item[prop] = deserializer(prop, item[prop]);\n\n        if (!visited.has(item[prop])) visited.add(item[prop]);\n    };\n}\n\nmodule.exports = {\n    dump: dump,\n    restore: restore\n};\n","'use strict';\n\nexport const isArray = Array.isArray;\n\nexport const merge = Object.assign;\n\nexport const keys = Object.keys;\n\nexport function isFunction (fn) {\n    return typeof fn === 'function';\n}\n\nexport function shellowClone (obj) {\n    return isArray(obj) ? obj.slice() : merge({}, obj);\n}\n\nexport function identity (key, value) {\n    return value;\n}\n\nconst regex = /^@\\d{1,}$/i;\n\nexport function isObjectRef (key) {\n    return regex.test(key);\n}\n\nexport function getId (n) {\n    return '@' + n;\n}\n\nexport function isPrimitiveProperty (obj, prop) {\n    if (prop != null) {\n        return isPrimitive(obj[prop]);\n    } else\n        return function (prop) {\n            return isPrimitive(obj[prop]);\n        };\n}\n\nexport function isPrimitive (value) {\n    return typeof value === 'string' ||\n        typeof value === 'number' ||\n        typeof value === 'boolean' ||\n        value === null;\n}\n\nexport function createObjectHandler (callback) {\n    const memo = new Map();\n\n    return isFunction(callback) ? objectHandler : identity;\n\n    function objectHandler (key, value) {\n        if (!memo.has(value))\n            memo.set(value, callback(key, value));\n\n        return memo.get(value);\n    }\n}\n"],"sourceRoot":"/source/"}